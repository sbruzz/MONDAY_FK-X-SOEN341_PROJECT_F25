@page
@model CampusEvents.Pages.Organizer.CreateEventModel
@{
    ViewData["Title"] = "Create Event";
    Layout = "_OrganizerLayout";
}

<div class="container mt-4">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/Organizer/Home">Home</a></li>
            <li class="breadcrumb-item"><a href="/Organizer/Events">My Events</a></li>
            <li class="breadcrumb-item active">Create Event</li>
        </ol>
    </nav>

    <div class="row">
        <div class="col-lg-8 offset-lg-2">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0"><i class="bi bi-calendar-plus"></i> Create New Event</h3>
                </div>
                <div class="card-body p-4">
                    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
                    {
                        <div class="alert alert-danger alert-dismissible fade show">
                            <i class="bi bi-exclamation-triangle-fill"></i> @Model.ErrorMessage
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    }

                    <form method="post">
                        <!-- Title -->
                        <div class="mb-3">
                            <label asp-for="Input.Title" class="form-label">
                                Event Title <span class="text-danger">*</span>
                            </label>
                            <input asp-for="Input.Title" class="form-control" placeholder="e.g., AI Workshop Series" required />
                            <span asp-validation-for="Input.Title" class="text-danger"></span>
                        </div>

                        <!-- Description -->
                        <div class="mb-3">
                            <label asp-for="Input.Description" class="form-label">
                                Description <span class="text-danger">*</span>
                            </label>
                            <textarea asp-for="Input.Description" class="form-control" rows="5"
                                      placeholder="Provide details about your event, what attendees will learn or experience..."
                                      required></textarea>
                            <span asp-validation-for="Input.Description" class="text-danger"></span>
                            <small class="text-muted">Be descriptive to attract more attendees</small>
                        </div>

                        <!-- Category -->
                        <div class="mb-3">
                            <label asp-for="Input.Category" class="form-label">
                                Category <span class="text-danger">*</span>
                            </label>
                            <select asp-for="Input.Category" class="form-select" required>
                                <option value="">Select a category...</option>
                                <option value="Academic">Academic</option>
                                <option value="Social">Social</option>
                                <option value="Sports">Sports</option>
                                <option value="Cultural">Cultural</option>
                                <option value="Career">Career</option>
                                <option value="Workshop">Workshop</option>
                                <option value="Other">Other</option>
                            </select>
                            <span asp-validation-for="Input.Category" class="text-danger"></span>
                        </div>

                        <!-- Date and Time -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="Input.EventDate" class="form-label">
                                        Event Date <span class="text-danger">*</span>
                                    </label>
                                    <input asp-for="Input.EventDate" type="date" class="form-control"
                                           min="@DateTime.Now.ToString("yyyy-MM-dd")" required />
                                    <span asp-validation-for="Input.EventDate" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="Input.EventTime" class="form-label">
                                        Event Time <span class="text-danger">*</span>
                                    </label>
                                    <input asp-for="Input.EventTime" type="time" class="form-control" required />
                                    <span asp-validation-for="Input.EventTime" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Location -->
                        <div class="mb-3">
                            <label asp-for="Input.Location" class="form-label">
                                Location <span class="text-danger">*</span>
                            </label>
                            <input asp-for="Input.Location" class="form-control"
                                   placeholder="e.g., EV Building, Room 3.309" required />
                            <span asp-validation-for="Input.Location" class="text-danger"></span>
                        </div>

                        <!-- Organization -->
                        <div class="mb-3">
                            <label asp-for="Input.OrganizationId" class="form-label">
                                Organization (Optional)
                            </label>
                            <select asp-for="Input.OrganizationId" class="form-select">
                                <option value="">No organization</option>
                                @foreach (var org in Model.Organizations)
                                {
                                    <option value="@org.Id">@org.Name</option>
                                }
                            </select>
                            <small class="text-muted">Select if this event is hosted by an organization/club</small>
                        </div>

                        <!-- Capacity -->
                        <div class="mb-3">
                            <label asp-for="Input.Capacity" class="form-label">
                                Capacity <span class="text-danger">*</span>
                            </label>
                            <input asp-for="Input.Capacity" type="number" class="form-control" min="1" max="10000"
                                   placeholder="Maximum number of attendees" required />
                            <span asp-validation-for="Input.Capacity" class="text-danger"></span>
                        </div>

                        <!-- Ticket Type -->
                        <div class="mb-3">
                            <label class="form-label">
                                Ticket Type <span class="text-danger">*</span>
                            </label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="Input.TicketType" id="ticketTypeFree"
                                       value="Free" checked onchange="togglePriceField()" />
                                <label class="form-check-label" for="ticketTypeFree">
                                    Free Event
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="Input.TicketType" id="ticketTypePaid"
                                       value="Paid" onchange="togglePriceField()" />
                                <label class="form-check-label" for="ticketTypePaid">
                                    Paid Event
                                </label>
                            </div>
                        </div>

                        <!-- Price (conditional) -->
                        <div class="mb-3" id="priceField" style="display: none;">
                            <label asp-for="Input.Price" class="form-label">
                                Ticket Price ($) <span class="text-danger">*</span>
                            </label>
                            <input asp-for="Input.Price" type="number" class="form-control" min="0" step="0.01"
                                   placeholder="0.00" />
                            <span asp-validation-for="Input.Price" class="text-danger"></span>
                            <small class="text-muted">Payment will be mock/simulated for prototype</small>
                        </div>

                        <!-- Submit Buttons -->
                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="bi bi-check-circle"></i> Create Event
                            </button>
                            <a href="/Organizer/Events" class="btn btn-outline-secondary">
                                <i class="bi bi-x-circle"></i> Cancel
                            </a>
                        </div>

                        <div class="mt-3 text-muted small">
                            <i class="bi bi-info-circle"></i> Your event will be submitted for admin approval before being published.
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        function togglePriceField() {
            const priceField = document.getElementById('priceField');
            const isPaid = document.getElementById('ticketTypePaid').checked;
            priceField.style.display = isPaid ? 'block' : 'none';

            // Set price to 0 if free
            if (!isPaid) {
                document.querySelector('input[name="Input.Price"]').value = '0';
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            togglePriceField();
        });
    </script>
}
