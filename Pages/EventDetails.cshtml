@page
@model PublicEventDetailsModel
@{
    ViewData["Title"] = Model.Event?.Title ?? "Event Details";
}

@section Styles {
    <link rel="stylesheet" href="~/css/event-details.css" asp-append-version="true" />
}

<!-- Main Content -->
@if (Model.Event != null)
{
    <div class="event-header">
        <a href="/Events" class="back-link">
            <i class="bi bi-arrow-left"></i>
            Back to Events
        </a>
        <div class="event-category">@Model.Event.Category</div>
        <h1 class="event-title-large">@Model.Event.Title</h1>
        <div class="event-meta-header">
            <div class="meta-item-header">
                <i class="bi bi-calendar3"></i>
                @Model.Event.EventDate.ToString("MMMM dd, yyyy")
            </div>
            <div class="meta-item-header">
                <i class="bi bi-clock"></i>
                @Model.Event.EventDate.ToString("h:mm tt")
            </div>
            <div class="meta-item-header">
                <i class="bi bi-geo-alt"></i>
                @Model.Event.Location
            </div>
        </div>
    </div>

    <div class="event-container">
        <div class="event-card-large">
            @if (!Model.IsLoggedIn)
            {
                <div class="cta-banner">
                    <h3><i class="bi bi-ticket-perforated"></i> Want to attend this event?</h3>
                    <p>Sign up or log in to claim your ticket and receive a QR code for entry</p>
                    <div class="cta-buttons">
                        <a href="/SignupStudent" class="btn btn-white">
                            <i class="bi bi-person-plus"></i>
                            Sign Up Now
                        </a>
                        <a href="/Login?returnUrl=%2FEventDetails%3Fid%3D@Model.Event.Id" class="btn btn-outline-white">
                            <i class="bi bi-box-arrow-in-right"></i>
                            Login
                        </a>
                    </div>
                </div>
            }
            else
            {
                <div class="cta-banner">
                    <h3><i class="bi bi-check-circle"></i> You're logged in!</h3>
                    <p>Go to your student dashboard to claim this ticket</p>
                    <div class="cta-buttons">
                        <a href="/Student/EventDetails?id=@Model.Event.Id" class="btn btn-white">
                            <i class="bi bi-ticket-detailed"></i>
                            View & Claim Ticket
                        </a>
                    </div>
                </div>
            }

            <div class="event-content-section">
                <h2 class="section-title">
                    <i class="bi bi-info-circle"></i>
                    About This Event
                </h2>
                <p class="event-description">@Model.Event.Description</p>

                <div class="event-info-grid">
                    <div class="info-card">
                        <div class="info-label">Date & Time</div>
                        <div class="info-value">
                            <i class="bi bi-calendar-event"></i>
                            @Model.Event.EventDate.ToString("MMM dd, yyyy ï¿½ h:mm tt")
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Location</div>
                        <div class="info-value">
                            <i class="bi bi-geo-alt-fill"></i>
                            @Model.Event.Location
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Ticket Price</div>
                        <div class="info-value">
                            <i class="bi bi-tag"></i>
                            @if (Model.Event.Price == 0)
                            {
                                <span style="color: var(--success);">FREE</span>
                            }
                            else
                            {
                                <span>$@Model.Event.Price.ToString("F2")</span>
                            }
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Capacity</div>
                        <div class="info-value">
                            <i class="bi bi-people"></i>
                            @Model.Event.TicketsIssued / @Model.Event.Capacity
                        </div>
                        <div class="capacity-bar-container">
                            <div class="capacity-bar-fill" style="width: @((Model.Event.TicketsIssued * 100.0 / Model.Event.Capacity).ToString("F0"))%"></div>
                        </div>
                    </div>
                </div>

                @if (Model.Event.Organization != null)
                {
                    <div class="info-card">
                        <div class="info-label">Organized By</div>
                        <div class="info-value">
                            <i class="bi bi-building"></i>
                            @Model.Event.Organization.Name
                        </div>
                        @if (!string.IsNullOrEmpty(Model.Event.Organization.Description))
                        {
                            <p style="margin-top: 1rem; color: var(--text-light);">@Model.Event.Organization.Description</p>
                        }
                    </div>
                }

                <div class="share-section">
                    <h3 class="share-title">
                        <i class="bi bi-share"></i>
                        Share This Event
                    </h3>
                    <div class="share-buttons">
                        <a href="https://www.facebook.com/sharer/sharer.php?u=@Uri.EscapeDataString(Model.ShareUrl)"
                           target="_blank" class="share-btn facebook" title="Share on Facebook">
                            <i class="bi bi-facebook"></i>
                        </a>
                        <a href="https://twitter.com/intent/tweet?text=@Uri.EscapeDataString("Check out " + Model.Event.Title + "!")&url=@Uri.EscapeDataString(Model.ShareUrl)"
                           target="_blank" class="share-btn twitter" title="Share on Twitter">
                            <i class="bi bi-twitter"></i>
                        </a>
                        <a href="mailto:?subject=@Uri.EscapeDataString("Check out: " + Model.Event.Title)&body=@Uri.EscapeDataString("I thought you might be interested in this event: " + Model.Event.Title + ". " + Model.ShareUrl)"
                           class="share-btn email" title="Share via Email">
                            <i class="bi bi-envelope"></i>
                        </a>
                    </div>
                    <div class="copy-link-box">
                        <input type="text" class="copy-link-input" value="@Model.ShareUrl" readonly id="shareUrl">
                        <button class="copy-link-btn" onclick="copyToClipboard()">
                            <i class="bi bi-clipboard"></i>
                            Copy Link
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <div style="text-align: center; padding: 4rem 2rem;">
        <h2>Event Not Found</h2>
        <p>The event you're looking for doesn't exist or has been removed.</p>
        <a href="/Events" class="btn btn-primary">Browse All Events</a>
    </div>
}

@section Scripts {
    <script src="~/js/event-details.js" asp-append-version="true"></script>
}
